window.onload=function(){var game=new Phaser.Game(960,540,Phaser.CANVAS,"div_game");game.state.add("boot",aimingtest.boot),game.state.add("menu",aimingtest.menu),game.state.add("inGame",aimingtest.inGame),game.state.start("boot")};var aimingtest={boot:function(game){}};aimingtest.boot.prototype=function(game){},aimingtest.boot.prototype={preload:function(){this.load.image("target","assets/images/target.png"),this.load.image("pointer","assets/images/pointer.png"),this.load.image("particle1","assets/images/particle1.png"),this.load.image("particle2","assets/images/particle2.png"),this.load.image("particle3","assets/images/particle3.png"),this.load.audio("shot","assets/sounds/165271__mojomills__cap-shot-2.mp3"),this.load.audio("hit","assets/sounds/249613__otisjames__explosionsfx.mp3"),this.load.audio("spawn","assets/sounds/11221__jnr-hacksaw__zap.mp3")},create:function(){this.state.start("menu")}},aimingtest.menu=function(game){},aimingtest.menu.prototype=function(game){},aimingtest.menu.prototype={create:function(){var text;this.stage.backgroundColor="rgb(106,98,60)",document.getElementById("display").innerHTML="AIMING TEST V1.0";var textStyle={font:"bold 32px Arial",fill:"#fff",align:"center",boundsAlignH:"center",boundsAlignV:"middle"};(text=this.add.text(0,0,"Use your mouse button to shoot the targets\n\nClick to start",textStyle)).setTextBounds(0,0,960,540),this.input.onDown.add(function(){this.input.onDown.removeAll();var t=this,counterSeconds=3;text.setText(counterSeconds.toString()),counterSeconds--;var counterInterval=setInterval(function(){text.setText(counterSeconds.toString()),--counterSeconds<0&&(clearInterval(counterInterval),t.game.state.start("inGame"))},1e3)},this)}},aimingtest.inGame=function(game){},aimingtest.inGame.prototype=function(game){},aimingtest.inGame.prototype={create:function(){this.shotsArray=[],this.hitsArray=[];var cookie=this.getCookie("aimingTestBest");this.bestScore=""!=cookie?parseInt(cookie):0,this.display=document.getElementById("display"),this.display.innerHTML="10 targets left",this.hitsArray.push(["HIT","TIME","DISTANCE","SCORE"]),this.reloadTime=!1,this.targetTimer,this.target,this.hitsCounter=0,this.targetsCounter=0,this.failedShotsCounter=0,this.bonusDistanceCounter=0,this.bonusTimeCounter=0,this.pointsTimeBonus=1e3,this.pointsDistanceBonus=400,this.targetStartTime,this.score=0,this.totalScore=0;var t=this;this.emitter=this.add.emitter(),this.emitter.makeParticles(["particle1","particle2","particle3"]),this.emitter.gravity=0,this.emitter.minSpeed=600,this.emitter.maxParticleSpeed=new Phaser.Point(800,800),this.emitter.minParticleSpeed=new Phaser.Point(-800,-800),this.emitter.alpha=.5,this.emitter.lifespan=1e3,this.emitter.height=90,this.emitter.width=90,this.emitter.maxParticles=30,this.sndShot=this.add.audio("shot",1,!1),this.sndHit=this.add.audio("hit",1,!1),this.sndTarget=this.add.audio("spawn",1,!1),this.target=this.add.sprite(this.math.between(80,880),this.math.between(80,460),"target"),this.target.anchor.setTo(.5,.5),this.target.inputEnabled=!0,this.target.visible=!1,this.targetTimer=setTimeout(t.resetTarget.bind(t),t.math.between(800,1100)),this.input.onDown.add(function(pointerPosition){if(!t.reloadTime){t.reloadTime=!0;var targetPosition=t.target.position,isHit=t.target.input.pointerOver();t.sndShot.play();var distance=parseInt(t.getDistance(pointerPosition,targetPosition));if(t.shotsArray.push(distance),isHit&&distance<70){t.clearTimer(),t.target.visible=!1;var targetHitTime=performance.now();t.sndHit.play(),t.emitter.x=targetPosition.x-40,t.emitter.y=targetPosition.y-40,t.emitter.explode(1e3,10),t.hitsCounter++;var timeSpan=parseInt(targetHitTime-t.targetStartTime),hitScore=parseInt(400-2*distance-timeSpan/10);if(t.score+=hitScore,distance<5&&t.bonusDistanceCounter++,timeSpan<400&&t.bonusTimeCounter++,t.hitsArray.push([t.hitsCounter,timeSpan+" ms",distance+" px",hitScore+" pts"]),10==this.targetsCounter)return void this.gameOver();setTimeout(t.resetTarget.bind(t),this.math.between(300,1e3))}else t.failedShotsCounter++;setTimeout(function(){t.reloadTime=!1},30)}},this)},resetTarget:function(){10!=this.targetsCounter?(this.targetsCounter++,this.sndTarget.play(),this.target.reset(this.math.between(80,880),this.math.between(80,460)),this.targetStartTime=performance.now(),this.setTimer(),this.display.innerHTML=10-this.targetsCounter+" targets left"):this.gameOver()},setTimer:function(){this.targetTimer=setTimeout(this.resetTarget.bind(this),this.math.between(800,1e3))},clearTimer:function(){clearTimeout(this.targetTimer)},getDistance:function(pointA,pointB){var dx=pointA.x-pointB.x,dy=pointA.y-pointB.y,distance;return Math.sqrt(dx*dx+dy*dy)},gameOver:function(){this.input.onDown.removeAll(),this.setTotalScore(),this.bestScore<this.totalScore?(this.display.innerHTML="You got a new record !!!",this.setCookie("aimingTestBest",this.totalScore,180)):this.display.innerHTML="Your best score is "+this.bestScore.toString(),this.showResults()},setTotalScore:function(){this.totalScore=this.score+this.bonusDistanceCounter*this.pointsDistanceBonus+this.bonusTimeCounter*this.pointsTimeBonus-400*this.failedShotsCounter},showResults:function(){var tableResults=document.getElementById("tbl_results"),cellType="th";this.hitsArray.forEach(element=>{var i=0,row=document.createElement("tr");for(i=0;i<4;i++){var cell=document.createElement(cellType);cell.textContent=element[i],row.appendChild(cell)}cellType="td",tableResults.appendChild(row)});var statsArray=[];statsArray.push("BONUS"),statsArray.push([this.bonusDistanceCounter+" x Distance < 5px","+"+this.bonusDistanceCounter*this.pointsDistanceBonus+" pts"]),statsArray.push([this.bonusTimeCounter+" x Time < 400ms","+"+this.bonusTimeCounter*this.pointsTimeBonus+" pts"]),statsArray.push("PENALTIES"),statsArray.push([this.failedShotsCounter+" x Failed Shots",-400*this.failedShotsCounter+" pts"]),statsArray.forEach(element=>{var i=0,rowSize=0,row=document.createElement("tr");for(Array.isArray(element)?(cellType="td",rowSize=2):(cellType="th",rowSize=1),i=0;i<rowSize;i++){var cell=document.createElement(cellType);"th"==cellType?(cell.setAttribute("colspan",4),cell.textContent=element):(cell.setAttribute("colspan",2),cell.textContent=element[i]),row.appendChild(cell)}tableResults.appendChild(row)});var row=document.createElement("tr"),cell=document.createElement("th");cell.setAttribute("colspan",4),cell.textContent="TOTAL SCORE",row.appendChild(cell),tableResults.appendChild(row),row=document.createElement("tr"),(cell=document.createElement("td")).setAttribute("colspan",4),cell.style.backgroundColor="red",cell.style.color="white",cell.style.fontSize="1.5em",cell.textContent=this.totalScore.toString(),row.appendChild(cell),tableResults.appendChild(row),tableResults.style.opacity="1",document.getElementById("replay").innerHTML="Click to replay";var t=this;setTimeout(function(){t.input.onDown.add(t.replay,t)},1500)},replay:function(){var tableResults=document.getElementById("tbl_results");tableResults.style.opacity=0,tableResults.innerHTML="",document.getElementById("replay").innerHTML="",this.state.start("menu")},setCookie:function(c_name,c_value,c_days){var d=new Date;d.setTime(d.getTime()+24*c_days*60*60*1e3);var expires="expires="+d.toUTCString();document.cookie=c_name+"="+c_value+";"+expires+";path=/"},getCookie:function(c_name){for(var name=c_name+"=",decodedCookie,ca=decodeURIComponent(document.cookie).split(";"),i=0;i<ca.length;i++){for(var c=ca[i];" "==c.charAt(0);)c=c.substring(1);if(0==c.indexOf(name))return c.substring(name.length,c.length)}return""}};